(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/task/createTask"],{2187:function(e,t,a){"use strict";a.r(t);var s=a("cb03"),n=a("f9f2");for(var i in n)"default"!==i&&function(e){a.d(t,e,function(){return n[e]})}(i);a("f7b5");var c,o=a("f0c5"),u=Object(o["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],c);t["default"]=u.exports},"580e":function(e,t,a){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("a34a"));function i(e){return e&&e.__esModule?e:{default:e}}function c(e,t,a,s,n,i,c){try{var o=e[i](c),u=o.value}catch(l){return void a(l)}o.done?t(u):Promise.resolve(u).then(s,n)}function o(e){return function(){var t=this,a=arguments;return new Promise(function(s,n){var i=e.apply(t,a);function o(e){c(i,s,n,o,u,"next",e)}function u(e){c(i,s,n,o,u,"throw",e)}o(void 0)})}}var u=function(){return Promise.all([a.e("common/vendor"),a.e("components/uni-calendar/uni-calendar")]).then(a.bind(null,"f766"))},l=function(){return Promise.all([a.e("common/vendor"),a.e("components/uni-icons/uni-icons")]).then(a.bind(null,"79e2"))},r=function(){return a.e("components/iking-select").then(a.bind(null,"3460"))};function d(){var e=new Date;return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)}function f(){var e=new Date;return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}var p={components:{uniCalendar:u,uniIcon:l,ikingSelect:r},data:function(){return{userType:this.$userInfo().userType,action:1,date:"",mapshow:!1,map:null,taskDesc:"",deviceNum:"1",imageList:[],sourceTypeIndex:1,sourceType:["拍照","相册","拍照或相册"],sizeTypeIndex:2,sizeType:["压缩","原图","压缩或原图"],countIndex:8,count:[1,2,3,4,5,6,7,8,9],deviceList:[],dateInfo:{date:d(),startDate:d(),time:f(),endDate:"",lunar:!1,range:!1,insert:!1,selected:[]},cycleTypeIndex:0,cycleTypeList:["每月","每周","每日"],cycleList:[{time:"09:09",date:0,dateSpan:"1"}],cycleDateList:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],week:["周一","周二","周三","周四","周五","周六","周日"],dateList:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],latitude:39.119929,longitude:117.752705,address:"",covers:[{latitude:39.9085,longitude:116.39747,iconPath:"../../../static/app-plus/location@3x.png"}],polyline:[{points:[{latitude:39.9085,longitude:116.39747},{latitude:39.9,longitude:116.39}],color:"#CCFFFF",width:5,dottedLine:!0,arrowLine:!0,borderColor:"#CC0000",borderWidth:3}],polygons:[{points:[{}]}],indicatorStyle:"height: ".concat(Math.round(s.getSystemInfoSync().screenWidth/7.5),"px;")}},watch:{cycleTypeIndex:function(t){console.log(e(t," at pages\\task\\createTask.vue:205"));var a=this;switch(Number(t)){case 0:a.cycleDateList=a.dateList;break;case 1:a.cycleDateList=a.week;break;case 2:a.cycleDateList=[];break;default:break}console.log(e(a.cycleList," at pages\\task\\createTask.vue:220")),a.cycleList=a.cycleList.map(function(e){return a.cycleDateList[e.date]||(e.date=0),e.dateSpan=a.cycleDateList[e.date],e}),console.log(e(a.cycleDateList," at pages\\task\\createTask.vue:228"))}},computed:{taskType:function(){return 1==this.action?"timeliness":2==this.action?"cycle":3==this.action?"urgent":void 0},cycleType:function(){return 0==this.cycleTypeIndex?"month":1==this.cycleTypeIndex?"week":2==this.cycleTypeIndex?"date":void 0}},methods:{previewImage:function(e){var t=e.target.dataset.src;s.previewImage({current:t,urls:this.imageList})},chooseImage:function(){var t=o(n.default.mark(function t(){var a,i=this;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(9!==this.imageList.length){t.next=7;break}return t.next=3,this.isFullImg();case 3:if(a=t.sent,console.log(e("是否继续?",a," at pages\\task\\createTask.vue:266")),a){t.next=7;break}return t.abrupt("return");case 7:s.chooseImage({sourceType:this.sourceType[this.sourceTypeIndex],sizeType:this.sizeType[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(e){i.imageList=i.imageList.concat(e.tempFilePaths)}});case 8:case"end":return t.stop()}},t,this)}));function a(){return t.apply(this,arguments)}return a}(),isFullImg:function(){var e=this;return new Promise(function(t){s.showModal({content:"已经有9张图片了,是否清空现有图片？",success:function(a){a.confirm?(e.imageList=[],t(!0)):t(!1)},fail:function(){t(!1)}})})},uploadImage:function(){var e=this.imageList.map(function(e,t){return{name:"image"+t,uri:e}}),t=this;this.$request.uploadFile("/files/ref",e).then(function(e){"0"==e.flag&&(t.referenceList=e.data,s.showToast({title:"上传成功"}))})},active:function(e){this.action=e},regionchange:function(e){},changeCycleType:function(e){this.cycleTypeIndex=e.detail.value},changeDate:function(t,a){this.cycleList[a].date=t.detail.value,this.cycleList[a].dateSpan=this.cycleDateList[t.detail.value],console.log(e(this.cycleList[a]," at pages\\task\\createTask.vue:337"))},selectTime:function(t,a){this.cycleList[a].time=t.detail.value,console.log(e(t,a," at pages\\task\\createTask.vue:342"))},addcycle:function(e){this.cycleList.push({time:"09:00",date:0,dateSpan:this.cycleDateList[0]})},delcycle:function(t){console.log(e(t," at pages\\task\\createTask.vue:354")),console.log(e(this.cycleList," at pages\\task\\createTask.vue:355")),this.cycleList.splice(t,1)},tap:function(t){this.polyline[0].points.push({latitude:t.detail.latitude,longitude:t.detail.longitude});var a=this;s.chooseLocation({success:function(t){console.log(e(t," at pages\\task\\createTask.vue:367")),a.latitude=t.latitude,a.longitude=t.longitude,a.covers[0].longitude=t.longitude,a.covers[0].latitude=t.latitude,a.address=t.address.replace("天津市滨海新区","")+("0"+(new Date).getHours()).substr(-2)+":"+("0"+(new Date).getMinutes()).substr(-2)}})},confirm:function(t){console.log(e("confirm 返回:",t," at pages\\task\\createTask.vue:377")),this.dateInfo.date=t.fulldate,this.dateInfo.time=t.time,this.mapshow=!1},close:function(){this.mapshow=!1},open:function(){this.$refs.calendar.open(),this.mapshow=!0},bindChange:function(t){this.deviceNum=t.detail.value[0]+1,console.log(e(this.deviceNum," at pages\\task\\createTask.vue:391"))},submit:function(){var t=this;s.hideKeyboard(),s.showModal({content:"是否提交任务？",confirmText:"确定",cancelText:"取消",success:function(a){a.confirm?(console.log(e("用户点击确定"," at pages\\task\\createTask.vue:403")),t.submitData()):a.cancel&&console.log(e("用户点击取消"," at pages\\task\\createTask.vue:406"))}})},submitData:function(){this.$request.post("/task/taskApply",{pkId:this.taskId,taskName:this.address,taskType:this.taskType,taskDesc:this.taskDesc,startTime:this.dateInfo.date+" "+this.dateInfo.time,cycleType:this.cycleType,cycleList:this.cycleList.map(function(e){return e.week=e.date,e}),deviceNum:this.deviceNum,mapType:"line",mapList:[{lng:this.longitude,lat:this.latitude}],referenceList:this.referenceList}).then(function(t){console.log(e(t," at pages\\task\\createTask.vue:436")),s.showToast({title:"提交成功"}),s.navigateBack()})},getTaskDetail:function(t){var a=this,s=this;return this.$request.post("/task/taskDetail",{pkId:t}).then(function(t){console.log(e(t," at pages\\task\\createTask.vue:450"));var n=t.data;if(0==t.flag)switch(a.taskInfo=n,"area"==n.mapType&&(a.polygons.points=n.mapList),a.address=n.name,a.latitude=a.taskInfo.mapList[0].lat,a.longitude=a.taskInfo.mapList[0].lng,s.covers[0].longitude=a.longitude,s.covers[0].latitude=a.latitude,n.type){case"timeliness":a.action=1,a.dateInfo.date=n.startTime.split(" ")[0],a.dateInfo.time=n.startTime.split(" ")[1],a.taskDesc=n.taskDesc;break;case"cycle":a.action=2,a.cycleList=n.cycleList,"month"==n.cycleType?(a.cycleList=a.cycleList.map(function(e){return e.date=Number(e.date)-1,e}),a.cycleTypeIndex=0):"week"==n.cycleType?(a.cycleList=a.cycleList.map(function(e){return e.date=Number(e.week)-1,e}),a.cycleTypeIndex=1):a.cycleTypeIndex=2;break;case"urgent":a.action=3;break;default:break}})}},onLoad:function(t){if(console.log(e(t," at pages\\task\\createTask.vue:499")),"revision"==t.type&&(this.taskId=t.taskId),t.taskId)this.getTaskDetail(t.taskId);else{var a=this;s.getLocation({type:"gcj02",geocode:!0,success:function(t){console.log(e(t," at pages\\task\\createTask.vue:512")),a.latitude=t.latitude,a.longitude=t.longitude,a.covers[0].longitude=t.longitude,a.covers[0].latitude=t.latitude,a.address=t.address.street+t.address.poiName+("0"+(new Date).getHours()).substr(-2)+":"+("0"+(new Date).getMinutes()).substr(-2)}})}},onReady:function(){s.loadFontFace({family:"ikingFont",source:"url(".concat(plus.io.convertLocalFileSystemURL("/static/font/SourceHanSansCN-Bold.otf"),")"),success:function(){console.log(e("success"," at pages\\task\\createTask.vue:533"))},fail:function(t){console.log(e("fail",JSON.stringify(t)," at pages\\task\\createTask.vue:536"))}});"dronePilot"==this.userType&&(this.action=3)}};t.default=p}).call(this,a("0de9")["default"],a("6e42")["default"])},cb03:function(e,t,a){"use strict";var s,n=function(){var e=this,t=e.$createElement,a=(e._self._c,e.__map(e.cycleList,function(t,a){var s=t.time.split(":"),n=t.time.split(":");return{$orig:e.__get_orig(t),g0:s,g1:n}}));e.$mp.data=Object.assign({},{$root:{l0:a}})},i=[];a.d(t,"b",function(){return n}),a.d(t,"c",function(){return i}),a.d(t,"a",function(){return s})},e444:function(e,t,a){"use strict";(function(e){a("c159"),a("921b");s(a("66fd"));var t=s(a("2187"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},f7b5:function(e,t,a){"use strict";var s=a("ff5d"),n=a.n(s);n.a},f9f2:function(e,t,a){"use strict";a.r(t);var s=a("580e"),n=a.n(s);for(var i in s)"default"!==i&&function(e){a.d(t,e,function(){return s[e]})}(i);t["default"]=n.a},ff5d:function(e,t,a){}},[["e444","common/runtime","common/vendor"]]]);