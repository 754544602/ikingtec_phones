(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/task/taskDetail"],{4577:function(t,e,s){"use strict";s.r(e);var n=s("f35a"),i=s.n(n);for(var a in n)"default"!==a&&function(t){s.d(e,t,function(){return n[t]})}(a);e["default"]=i.a},"57cf":function(t,e,s){"use strict";var n,i=function(){var t=this,e=t.$createElement;t._self._c},a=[];s.d(e,"b",function(){return i}),s.d(e,"c",function(){return a}),s.d(e,"a",function(){return n})},"5a71":function(t,e,s){},"656c":function(t,e,s){"use strict";var n=s("5a71"),i=s.n(n);i.a},b3d9:function(t,e,s){"use strict";s.r(e);var n=s("57cf"),i=s("4577");for(var a in i)"default"!==a&&function(t){s.d(e,t,function(){return i[t]})}(a);s("656c");var o,c=s("f0c5"),u=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);e["default"]=u.exports},c834:function(t,e,s){"use strict";(function(t){s("c159"),s("921b");n(s("66fd"));var e=n(s("b3d9"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("6e42")["createPage"])},f35a:function(t,e,s){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(s("a34a"));function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e,s,n,i,a,o){try{var c=t[a](o),u=c.value}catch(r){return void s(r)}c.done?e(u):Promise.resolve(u).then(n,i)}function c(t){return function(){var e=this,s=arguments;return new Promise(function(n,i){var a=t.apply(e,s);function c(t){o(a,n,i,c,u,"next",t)}function u(t){o(a,n,i,c,u,"throw",t)}c(void 0)})}}var u=function(){return s.e("components/uni-rate/uni-rate").then(s.bind(null,"879c"))},r=function(){return s.e("components/uni-nav-bar/uni-nav-bar").then(s.bind(null,"b598"))},l=function(){return s.e("components/blackmonth-swiper/index").then(s.bind(null,"349e"))},f=function(){return Promise.all([s.e("common/vendor"),s.e("components/uni-calendar/uni-calendar")]).then(s.bind(null,"f766"))},h=function(){return Promise.all([s.e("common/vendor"),s.e("components/uni-icons/uni-icons")]).then(s.bind(null,"79e2"))},d=function(){return s.e("components/uni-drawer/uni-drawer").then(s.bind(null,"41fd"))},m=function(){return s.e("components/uni-list/uni-list").then(s.bind(null,"82a7"))},k=function(){return s.e("components/uni-list-item/uni-list-item").then(s.bind(null,"7c29"))},p=function(){return s.e("components/img-preview/img-preview").then(s.bind(null,"450a"))},g="#2727fd",v="#22df1d",I="#d8df1d",T="#df1d1d";function b(){var t=new Date;return t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)}var w=[["camera"],["album"],["camera","album"]],y=[["compressed"],["original"],["compressed","original"]],x={components:{uniRate:u,uniNavBar:r,customSwiper:l,uniCalendar:f,uniIcons:h,imgPreview:p,uniDrawer:d,uniList:m,uniListItem:k},data:function(){return{userType:this.$userInfo().userType,showLeft:!1,mapShow:!0,taskInfo:{pkId:1,name:"--",personId:1,personName:"--",personPhone:"--",deviceId:1,deviceName:"--",startTime:"2020-01-01 12:00",endTime:"2020-01-01 13:00",type:"timeliness",taskDesc:"",taskstaisDesc:"",status:"being",flyTime:"10:00",mapType:"area",mapList:[],cycleType:"date",cycleList:[{id:1,date:"1",week:"1",time:"9:00"},{id:2,date:"2",week:"2",time:"12:00"},{id:2,date:"3",week:"7",time:"13:00"}],approveList:[],imageList:[],videoList:[],referenceList:[],satisfaction:0,satisfactionDesc:"描述"},date:b(),status:"已结束",statusCode:4,submitText:"提交",action:1,latitude:39.119929,longitude:117.752705,rateColor:"#b5b5b5",rateActiveColor:"#1d94df",rateValue:5,isDetail:!1,video:null,src:null,imageList:[],imageDetail:!1,current:0,videoSrc:"",sourceTypeIndex:1,sourceType:["拍照","相册","拍照或相册"],sizeTypeIndex:2,sizeType:["压缩","原图","压缩或原图"],countIndex:8,count:[1,2,3,4,5,6,7,8,9],covers:[],polyline:[]}},methods:{active:function(t){this.action=t,this.video.pause()},rateChange:function(t){this.rateValue=t.value},back:function(){t.navigateBack()},submit:function(){},showList:function(){this.showLeft=!0,this.mapShow=!1},closeDrawer:function(){this.mapShow=!0,this.showLeft=!1},changeTask:function(t){var e=this;this.getTaskDetail(t.id).then(function(t){e._ready(),e.showLeft=!1})},endTask:function(){var e=this;t.showModal({content:"是否结束任务？",showCancel:!0,cancelText:"取消",confirmText:"确认",success:function(t){t.confirm&&e.$request.post("/task/finishTask",{pkId:e.taskId}).then(function(t){e.getTaskDetail().then(function(t){e._ready()})})}})},changeDate:function(){this.$refs.calendar.open()},dateConfirm:function(){},dateClose:function(){},taskShare:function(){var e=this;t.showModal({content:"是否分享该任务？",showCancel:!0,cancelText:"取消",confirmText:"确认",success:function(s){s.confirm&&e.$request.post("/task/taskShare",{pkId:e.taskId}).then(function(e){0==e.flag?t.showToast({title:"分享成功"}):t.showToast({title:e.message,icon:"none"})})}})},clickPic:function(e){t.previewImage({urls:this.taskInfo.imageList.map(function(t){return t.url}),current:this.taskInfo.imageList.map(function(t){return t.url})[e]})},clickRef:function(e){t.previewImage({urls:this.taskInfo.referenceList.map(function(t){return t.url}),current:this.taskInfo.referenceList.map(function(t){return t.url})[e]})},clickImage:function(e,s){t.previewImage({urls:e.map(function(t){return t.url}),current:e.map(function(t){return t.url})[s]})},imageLoad:function(t){console.log(n(t," at pages\\task\\taskDetail.vue:431"))},closeImage:function(){this.imageDetail=!1},chooseImage:function(){var e=c(i.default.mark(function e(){var s,a=this;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(9!==this.imageList.length){e.next=7;break}return e.next=3,this.isFullImg();case 3:if(s=e.sent,console.log(n("是否继续?",s," at pages\\task\\taskDetail.vue:439")),s){e.next=7;break}return e.abrupt("return");case 7:t.chooseImage({sourceType:w[this.sourceTypeIndex],sizeType:y[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(t){a.imageList=a.imageList.concat(t.tempFilePaths)}});case 8:case"end":return e.stop()}},e,this)}));function s(){return e.apply(this,arguments)}return s}(),isFullImg:function(){var e=this;return new Promise(function(s){t.showModal({content:"已经有9张图片了,是否清空现有图片？",success:function(t){t.confirm?(e.imageList=[],s(!0)):s(!1)},fail:function(){s(!1)}})})},uploadImage:function(){var e=this,s=this.imageList.map(function(t,e){return{name:"image"+e,uri:t}});this.src&&s.push({name:"video",uri:this.src});var n=this,i="/files";"demand"==this.userType&&(i="/files/ref"),this.$request.uploadFile(i,s,{taskId:this.taskInfo.pkId}).then(function(s){"0"==s.flag&&(n.imageList=[],e.getTaskDetail(e.taskInfo.pkId),t.showToast({title:"上传成功"}))})},previewImage:function(e){var s=e.target.dataset.src;t.previewImage({current:s,urls:this.imageList})},chooseVideo:function(){var e=this;t.chooseVideo({sourceType:w[this.sourceTypeIndex],success:function(t){e.src=t.tempFilePath}})},setStyle:function(t,e,s){var n=getCurrentPages(),i=n[n.length-1];e.length>3&&(e=e.substr(0,3)+"...");var a=i.$getAppWebview(),o=a.getStyle().titleNView;o.buttons[t].text=e,o.buttons[t].color=s,a.setStyle({titleNView:o})},getTaskDetail:function(t){var e=this,s=this;return this.$request.post("/task/taskDetail",{pkId:t||this.taskId}).then(function(n){var i=n;if(0==i.flag){var a=s.taskInfo.taskList;s.taskInfo=JSON.parse(JSON.stringify(i.data)),s.taskInfo.taskList||(s.taskInfo.taskList=[]),s.taskInfo.taskList.pop(),s.taskInfo.taskList.unshift({id:e.taskId,startTime:"当前任务"}),t&&(s.taskInfo.taskList=a);var o=JSON.parse(JSON.stringify(s.taskInfo.mapList.map(function(t){return t.latitude=t.lat,t.longitude=t.lng,t})));"line"==s.taskInfo.mapType&&(s.covers=o),s.latitude=s.taskInfo.mapList[0].lat,s.longitude=s.taskInfo.mapList[0].lng,s.polyline.push({points:o})}return i})},_ready:function(){switch(this.video=t.createVideoContext("video1",this),console.log(n(this.taskInfo.status," at pages\\task\\taskDetail.vue:590")),this.taskInfo.status){case"waitApprove":this.status="待审批",this.statusCode=1,this.submitText="关闭",this.titleColor=g,this.submit=function(){t.navigateBack()};break;case"waitStart":this.status="通过",this.statusCode=2,this.submitText="开始任务",this.titleColor=g,this.submit=function(){var e=this;t.showModal({content:"是否开始任务？",showCancel:!0,cancelText:"取消",confirmText:"确认",success:function(t){t.confirm&&e.$request.post("/task/startTask",{pkId:e.taskId}).then(function(t){console.log(n(t," at pages\\task\\taskDetail.vue:619")),0==t.flag&&e.getTaskDetail().then(function(t){e._ready()})})}})};break;case"noApprove":this.status="拒绝",this.statusCode=3,this.submitText="修改",this.titleColor=T,this.submit=function(){t.redirectTo({url:"/pages/task/createTask?taskId=".concat(this.taskId,"&type=revision")})};break;case"being":if(this.status="执行中",this.statusCode=4,this.titleColor=v,"dronePilot"==this.userType){console.log(n(this.taskInfo," at pages\\task\\taskDetail.vue:647"));var e="",s=this;this.taskInfo.taskList.forEach(function(t){"being"==t.status&&t.id!=s.taskId&&(e="being")}),this.submitText="","cycle"==this.taskInfo.type&&this.taskInfo.pkId==this.taskInfo.taskId&&"being"!=e?(this.submitText="开始任务",this.submit=function(){var e=this;t.showModal({content:"是否开始任务？",showCancel:!0,cancelText:"取消",confirmText:"确认",success:function(t){t.confirm&&e.$request.post("/task/startTask",{pkId:e.taskId}).then(function(t){console.log(n(t," at pages\\task\\taskDetail.vue:669")),0==t.flag&&e.getTaskDetail(t.data.id).then(function(t){e._ready()})})}})}):"cycle"==this.taskInfo.type&&this.taskInfo.pkId==this.taskInfo.taskId?this.submitText="":(this.submitText="任务完成",this.submit=function(){var e=this;t.showModal({content:"任务是否完成？",showCancel:!0,cancelText:"取消",confirmText:"确认",success:function(s){s.confirm&&e.$request.post("/task/successTask",{pkId:e.taskInfo.pkId}).then(function(s){0==s.flag?(t.showToast({title:"操作成功",icon:"none"}),e.getTaskDetail().then(function(t){e._ready()})):t.showToast({title:"操作失败",icon:"none"})})}})})}else this.submitText="实时",this.submit=function(){t.switchTab({url:"/pages/realtime/realtime"})};break;case"waitEval":if(this.status="待评价",this.statusCode=5,this.submitText="提交",this.titleColor=I,"dronePilot"==this.userType)return void(this.submitText="");this.submit=function(){var e=this;t.showModal({content:"是否确定提交？",showCancel:!0,cancelText:"取消",confirmText:"确认",success:function(t){t.confirm&&e.$request.post("/task/applySatisfaction",{pkId:e.taskId,rateNum:e.rateValue,opinion:e.taskstaisDesc}).then(function(t){console.log(n(t," at pages\\task\\taskDetail.vue:751")),0==t.flag&&e.getTaskDetail().then(function(t){e._ready()})})}})};break;case"finish":this.status="已结束",this.statusCode=6,this.submitText="再次提交",this.titleColor=T,this.isDetail=!0,"dronePilot"==this.userType&&(this.submitText=""),this.submit=function(){t.redirectTo({url:"/pages/task/createTask?taskId=".concat(this.taskId,"&type=restart")})};break;default:break}this.setStyle(0,this.status,this.titleColor),t.setNavigationBarTitle({title:this.taskInfo.name}),this.map=t.createMapContext("map1",this)}},computed:{rateSpan:function(){var t;return t=this.rateValue<3?"不满意":3==this.rateValue?"一般":"满意",t},cycleTypeName:function(){var t=[],e=this;return this.taskInfo.cycleList.forEach(function(s){switch(e.taskInfo.cycleType){case"month":t.push("每月 ".concat(s.date,"日 ").concat(s.time));break;case"week":var n=["一","二","三","四","五","六","日"];t.push("每周".concat(n[s.week-1]," ").concat(s.time));break;case"date":t.push("每日 ".concat(s.time));break}}),t}},onLoad:function(t){var e=this;console.log(n("load"," at pages\\task\\taskDetail.vue:823")),this.taskId=t.taskId,this.getTaskDetail().then(function(t){e._ready()})},onReady:function(){t.loadFontFace({family:"ikingFont",source:"url(".concat(plus.io.convertLocalFileSystemURL("/static/font/SourceHanSansCN-Bold.otf"),")"),success:function(){console.log(n("success"," at pages\\task\\taskDetail.vue:840"))},fail:function(t){console.log(n("fail",JSON.stringify(t)," at pages\\task\\taskDetail.vue:843"))}})}};e.default=x}).call(this,s("6e42")["default"],s("0de9")["default"])}},[["c834","common/runtime","common/vendor"]]]);